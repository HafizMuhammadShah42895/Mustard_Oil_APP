<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Orders</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <style>
    body {
      background-color: #F5F5DC; /* Beige */
      color: #333;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    h2 {
      color: #4CAF50; /* Earthy green */
    }

    .card {
      border: none;
      background-color: #fff;
      border-left: 5px solid #6B8E23; /* Olive */
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    /* Primary action button - green tone */
    .btn-home {
      background-color: #4CAF50;
      color: white;
      border: none;
    }

    .btn-home:hover {
      background-color: #45a049;
    }

    /* Change Address Button */
    .btn-warning {
      background-color: #f0c300; /* warm yellow */
      border: none;
      color: #333;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-warning:hover {
      background-color: #e6b800;
      color: #222;
    }

    /* Cancel Order Button */
    .btn-danger {
      background-color: #e74c3c;
      border: none;
      color: white;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-danger:hover {
      background-color: #c0392b;
      color: #fff;
    }

    .highlight {
      color: #9ACD32; /* Lime green accent */
    }
  </style>
</head>
<body>
  <div class="container mt-5" data-aos="fade-up">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="highlight">My Orders</h2>
      <a href="{{ url_for('customer_bp.home') }}" class="btn btn-home">‚Üê Back to Home</a>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert" data-aos="fade-down">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if orders %}
      {% set non_cancelled_orders = orders | selectattr("status", "ne", "Cancelled") | list %}
      {% if non_cancelled_orders %}
        {% for order in non_cancelled_orders %}
          <div class="card mb-4 shadow-sm" data-aos="fade-up">
            <div class="card-body">
              <h5 class="card-title">Order #{{ order.id }}</h5>
              <p><strong>Total Amount:</strong> Rs. {{ order.total_price }}</p>
              <p><strong>Status:</strong> {{ order.status }}</p>
              <p><strong>Shipping Address:</strong> {{ order.address }}</p>
              <p><strong>Items:</strong></p>
              <ul>
                {% for item in order.order_items %}
                  <li>{{ item.quantity }} x {{ item.product.name }} @ Rs. {{ item.price }} each</li>
                {% endfor %}
              </ul>
              <div class="mt-3 d-flex gap-2">
                <a href="{{ url_for('customer_bp.change_order_address', order_id=order.id) }}" class="btn btn-warning btn-sm">
                  Change Address
                </a>
                <a href="{{ url_for('customer_bp.cancel_order', order_id=order.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to cancel this order?');">
                  Cancel Order
                </a>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="alert alert-info" data-aos="fade-in">You haven't placed any active orders.</div>
      {% endif %}
    {% else %}
      <div class="alert alert-info" data-aos="fade-in">You haven't placed any orders yet.</div>
    {% endif %}
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({
      duration: 1000,
      once: true,
    });
  </script>
</body>
</html>
